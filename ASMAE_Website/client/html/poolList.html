<template name="poolList">


<div id="PoolListWrapper">

        <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand"> Poules </li>
                <li>
                    <select class="form-control Year" id="Year" style="width:50%;" text-align="center">
                      <option value="" disabled="" selected="" hidden>Année</option>
                      <option value="2015"> 2015 </option>
                    </select>
                </li>
                {{#with getYear}}
                  <li>{{>CategorySelect TYPE="men" DESC="Homme"}}</li>
                  <li>{{>CategorySelect TYPE="women" DESC="Femme"}}</li>
                  <li>{{>CategorySelect TYPE="mixed" DESC="Mixte"}}</li>
                  <li>{{>CategorySelect TYPE="family" DESC="Familles"}}</li>
                {{/with}}
            </ul>
        </div>
        <!-- /#sidebar-wrapper -->

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <div class="container-fluid">
                    <div class="col-lg-20">
                        <a href="#menu-toggle" class="btn btn-default" id="menu-toggle">Toggle Menu</a>
                          <div id="infoBox" class="alert alert-info" role="alert" hidden>
                            <h4>
                              <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
                              <span class="sr-only">Info:</span>
                              <span id="infoMsg"></span>
                            </h4>
                          </div>

                          {{#if getChosenScorePool}}
                            {{>scoreTable getChosenScorePool}}
                          {{else}}
                            {{#if chosenBrackets}}
                              {{>brackets}}
                            {{else}}
                                <!-- Pool Tables -->
                              <table id='allTables' class='table'>
                              <tr>
                                <td>
                                  <table id='poolTable' class='table'>
                                    {{#with getYear}} <!-- Returns a yearData -->
                                    {{resetDrake}} <!-- Resets the draggable objects, so that we can move the ones that are created -->    
                                        {{#with getType this}}
                                            {{#each getPools this}} <!-- Returns a list of lists of poolData, one list by column -->
                                              <tr>
                                              {{#each this}} <!-- For each pool in the column -->
                                                {{>poolContainerTemplate POOL=this}}
                                              {{/each}}
                                              </tr>
                                            {{/each}}
                                      {{/with}}
                                    {{/with}}
                                  </table>
                                </td>
                                <td id='pairsToRemoveColumn'>
                                  {{#with getYear}}
                                    {{#with getType this}}
                                      {{>pairsToRemoveContainerTemplate}}
                                    {{/with}}
                                  {{/with}}
                                </td>


                              </tr>
                              </table>

                              {{#with getYear}}
                                {{#with getType this}}
                                  <button type="button" id="savePools" class="btn btn-default btn-lg">
                                    <span class="glyphicon glyphicon-star" aria-hidden="true"></span> Sauver
                                  </button>

                                  <button type="button" id="addPool" class="btn btn-default btn-lg">
                                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Poule
                                  </button>
                                 {{/with}}
                              {{/with}}

                                <div id="successBox" class="alert alert-success" role="alert" hidden>
                                  <h4>
                                    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                                    <span class="sr-only">Succès:</span>
                                    <span id="infoMsg">Poules sauvées !</span>
                                  </h4>
                                </div>
                          {{/if}}
                        {{/if}}

                    </div>
            </div>
        </div>
        <!-- /#page-content-wrapper -->

    </div>


    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#PoolListWrapper").toggleClass("toggled");
    });
    </script>



</template>

<!-- Param : TYPE -->
<template name="CategorySelect">
  <span class="glyphicon glyphicon-menu-right" id="{{TYPE}}_glyphicon_type" style="display:none;"></span> 
  <a href="#" id="btn_{{TYPE}}" data-toggle="collapse" class="collapsableMenu collapseType" data-target="#{{TYPE}}" aria-expanded="false" style="text-decoration: none;">{{DESC}} {{getTypeCompletion TYPE}}</a>
  <ul class="nav collapse CategoryOption" id="{{TYPE}}" role="menu" aria-labelledby="btn-{{TYPE}}">
    <li>{{>poolBracketsSelect ID=TYPE CAT="preMinimes" DESC="Pré Minimes"}}</li>
    <li>{{>poolBracketsSelect ID=TYPE CAT="minimes" DESC="Minimes"}}</li>
    <li>{{>poolBracketsSelect ID=TYPE CAT="cadets" DESC="Cadet"}}</li>
    <li>{{>poolBracketsSelect ID=TYPE CAT="scolars" DESC="Scolaires"}}</li>
    <li>{{>poolBracketsSelect ID=TYPE CAT="juniors" DESC="Junior"}}</li>
    <li>{{>poolBracketsSelect ID=TYPE CAT="seniors" DESC="Seniors"}}</li>
    <li>{{>poolBracketsSelect ID=TYPE CAT="elites" DESC="Elites"}}</li>
  </ul>
</template>

<template name="poolBracketsSelect">
  <span class="glyphicon glyphicon-menu-right" id="{{this.ID}}_{{this.CAT}}_glyphicon_category" style="display:none;"></span> 
  <a href="#" id="btn_{{this.ID}}_{{this.CAT}}" data-toggle="collapse" class="collapsableMenu collapseCategory" data-target="#{{this.ID}}_{{this.CAT}}" aria-expanded="false" style="text-decoration: none; display:inline;">{{this.DESC}} {{getCategoryCompletion this.ID this.CAT}}</a>
  <ul class="nav collapse PoolBracketOption" id="{{this.ID}}_{{this.CAT}}" role="menu" aria-labelledby="btn-{{this.ID}}_{{this.CAT}}">
    <li class="PoolOption" data-category="{{this.CAT}}" data-type="{{this.ID}}" >
      <span class="glyphicon glyphicon-menu-right" id="{{this.ID}}_{{this.CAT}}_glyphicon_pool" style="display:none"></span> 
      Poules {{getPoulesCompletion this.ID this.CAT}}
    </li>
    <li class="BracketOption" data-category="{{this.CAT}}" data-type="{{this.ID}}">
      <span class="glyphicon glyphicon-menu-right" id="{{this.ID}}_{{this.CAT}}_glyphicon_bracket" style="display:none"></span> 
      Tournoi {{getBracketCompletion this.ID this.CAT}}
    </li>
  </ul>
</template>

<!-- Takes 1 argument : the pool -->
<template name="poolContainerTemplate">
        <td>
          <div class='parent'>
            <h3>
              {{#unless moreThanOnePair POOL.pairs}}
                <button type="button" id="removePool" class="btn btn-default btn-lg" data-poolid="{{POOL._id}}">
                  <span class="glyphicon glyphicon-remove removePoolButton" aria-hidden="true"></span> 
                </button>
              {{/unless}}

              {{#if moreThanOnePair POOL.pairs}}
              <!-- <a href="{{pathFor route='scoreTable' poolId=POOL._id}}" style="text-decoration:none;"> -->
              <button type="button" class="btn btn-default btn-lg scoreButton" data-poolId="{{POOL._id}}">
                <span class="glyphicon glyphicon-stats" aria-hidden="true"></span> 
              </button>
              <!-- </a> -->
              {{/if}}
              <label class='label label-primary' for='hy'>Poule</label> <!-- TODO : set the pool name to the court address -->
              
            </h3>
            <div class='PoolWrapper'>
              <div class='poolContainer' id='{{POOL._id}}'> <!-- _id is here the id of the pool -->
                {{#each POOL.pairs}} <!-- For each pair id in the pool -->
                  {{>poolItem PAIRID=this POOLID=../POOL._id LEADER=../POOL.leader}} <!-- Set ID to the id of the pool, so that we can make it draggable -->
                {{/each}}
              </div>
            </div>
          </div>
        </td>
</template>

<template name="pairsToRemoveContainerTemplate">
  <div class='parent' id='pairstoremoveparent'>
    <h3>
      <label class='label label-primary' for='hy'>Paires à retirer</label>
    </h3>
    <div class='PoolWrapper'>
      <div class='poolContainer' id='pairstoremove'>
          <!-- Empty -->
      </div>
    </div>
  </div>
</template>

<!-- 
  Takes 2 arguments :
  - PAIRID : the id of this pair
  - POOLID : the id of the pool of this pair 
-->
<template name="poolItem">
  {{#with getPair PAIRID}} <!-- get the pair data using its id -->
    <div id="{{this._id}}" class="pairs" data-startingPoolId="{{../POOLID}}">
      <ul class="list-group" data-target="{{getModalId}}" data-toggle="modal">
        {{#with getPlayer this.player1._id}}
          <li class="list-group-item pairPlayer {{getColor ../player1}}" id="{{this.player1._id}}" >{{profile.firstName}} {{profile.lastName}} {{#if equals ../_id ../../LEADER}}<span class="glyphicon glyphicon-star" style="color:#4CC417" aria-hidden="true"></span>{{/if}}</li>
          
        {{/with}}
        {{#with getPlayer this.player2._id}}
          <li class="list-group-item pairPlayer {{getColor ../player2}}" id="{{this.player2._id}}" >{{profile.firstName}} {{profile.lastName}}</li>
        {{/with}}
      </ul>
    </div>

  <!-- Modal -->
  <div id="{{getModalPureId}}" class="modal fade pairInfoModal" role="dialog" style="cursor:auto">
    <div class="modal-dialog">

      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <div class="modal-title page-header">
            <h1><small>Information sur la paire</small></h1>
          </div>
        </div>
        

        <div class="modal-body">
          <div class="panel panel-primary pairInfoBox">
            {{>playerInfoTemplate ID=this.player1._id MODAL=getModalId}}
            
            {{#if this.player1.wish}}
              <h3>Souhaits</h3>
              {{this.player1.wish}}
            {{/if}}
            {{#if this.player1.constraint}}
              <h3>Contraintes</h3>
              {{this.player1.constraint}}
            {{/if}}
          </div>
          <div class="panel panel-primary pairInfoBox">
            {{>playerInfoTemplate ID=this.player2._id MODAL='pairModal'}}

            {{#if this.player2.wish}}
              <h3>Souhaits</h3>
              {{this.player2.wish}}
            {{/if}}
            {{#if this.player2.constraint}}
              <h3>Contraintes</h3>
              {{this.player2.constraint}}
            {{/if}}
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
        </div>
      </div>

    </div>
  </div>


  {{/with}}
</template>