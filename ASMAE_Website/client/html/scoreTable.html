
<!-- Takes 1 parameter : the poolId for this score table under the format {_id:POOLID}-->
<template name="scorePage">
  <!-- link to style for button http://bootsnipp.com/snippets/featured/bootstrap-square-buttons -->
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
  <!-- Some scripts added to print the table into the pdf -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.0.272/jspdf.debug.js"></script>

  <table class="table">
    <tbody>
      <tr>
        <td align="center">
          {{#with getLeader this._id}}
          <h3>Chef de poule: </h3>
          <address>
            <a href="mailto:{{getEmail this}}" class="btn btn-sq-lg btn-primary">
              <i class="fa fa-user fa-5x"></i><br/>
              <strong>{{this.profile.firstName}} {{this.profile.lastName}}</strong><br>
              {{#unless equals this.profile.phone undefined}}<abbr title="Phone">Téléphone:</abbr> {{this.profile.phone}} <br>{{/unless}}
              {{getEmail this}}<br>
            </a>
          </address>
          {{/with}}
        </td>

        <!-- {{#with getStaff this._id}} -->
        <!-- <td align="center">
          <h3>Responsable: </h3>
          <address>
            <a href="mailto:#" class="btn btn-sq-lg btn-primary">
              <i class="fa fa-user fa-5x"></i><br/>
              <strong> Nom Prénom </strong> <br>
              <abbr title="Phone">Téléphone:</abbr> 0032 12345678<br>
              mail
              <! <strong>{{this.profile.firstName}} {{this.profile.lastName}}</strong><br>
              {{#unless equals this.profile.phone undefined}}<abbr title="Phone">Téléphone:</abbr> {{this.profile.phone}} <br>{{/unless}}
              {{getEmail this}}<br>
            </a>
          </address>
          <! {{/with}} COMMENT HERE>
        </td> -->
      </tr>
    </tbody>
  </table>

  {{>scoreTable this}}

  {{#if isAdminOrStaff}}
    <button type="button" id="save" class="btn btn-default btn-lg">
      <span class="glyphicon glyphicon-star" aria-hidden="true"></span> Sauver
    </button>
    <button type="button" id="getPDF" class="btn btn-default btn-lg" data-pool="{{this._id}}">
      <span class="glyphicon glyphicon-download" aria-hidden="true"></span> PDF
    </button>

    <div id="successBox" class="alert alert-success" role="alert" hidden>
      <h4>
        <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
        <span class="sr-only">Succès:</span>
        <span id="infoMsg">Scores sauvés !</span>
      </h4>
    </div>
  {{/if}}
</template>


<!-- Takes 1 parameter : the poolId for this score table under the format {_id:POOLID}-->
<template name="scoreTable">
  <div id="scoreTab">
    <h3>Les paires dans la colonne jouent contre les paires de la ligne.</h3>
    <div class="panel panel-primary" style="background-color:white">
      <div class="panel-heading">Tableaux des résultats</div>
      <table class="table table-bordered">
        {{#with getPairs this._id}}
        <thead>
          <tr>
            <th>
              <h4><span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span> VS <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span> </h4>
            </th>
            {{#each this}}
            <th>
              {{#with getPlayer this.player1._id}}
              {{this.profile.firstName}} {{this.profile.lastName}} <br>
              {{/with}}
              {{#with getPlayer this.player2._id}}
              {{this.profile.firstName}} {{this.profile.lastName}}
              {{/with}}
            </th>
            {{/each}}
          </tr>
        </thead>

        <tbody>
          {{#each this}}
          <tr>
            <th>
              {{#with getPlayer this.player1._id}}
              {{this.profile.firstName}} {{this.profile.lastName}} <br>
              {{/with}}
              {{#with getPlayer this.player2._id}}
              {{this.profile.firstName}} {{this.profile.lastName}}
              {{/with}}
            </th>

            {{#each ..}}
            {{#if equals this._id ../_id}}
            <td class="selfMatch" style="background-color:grey">  </td>
            {{else}}
            <td align="center">
              <div class="input-group inputscore" display="inline">
                {{#with getMatch ../../../_id ../_id this._id}} <!-- Returns the match corresponding to this pair -->
                  {{#if isAdminOrStaff}}
                    <input
                    type="number"
                    min="0"
                    step="1"
                    class="form-control points"
                    data-matchid="{{this._id}}"
                    data-pairid="{{../../_id}}"
                    value="{{getPoints this ../../_id}}"
                    style="text-align:center;">
                  {{else}}
                    <span style="align:center; position: relative; top: 50%; transform: translateY(-50%); font-size:200%;">{{getPoints this ../../_id}}</span>
                  {{/if}}
                {{/with}}
              </div>
            </td>
            {{/if}}
            {{/each}}
          </tr>
          {{/each}}
        </tbody>
        {{/with}}
      </table>
    </div>
  </div>



  <!-- Frame for the pdf viewer -->
  <iframe class="preview-pane" type="application/pdf" height="900" width="100%" frameborder="0" hidden></iframe>
  <br>

</template>
