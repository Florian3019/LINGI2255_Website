
<!-- Takes 1 parameter : the poolId for this score table under the format {_id:POOLID}-->
<template name="scorePage">
  <!-- link to style for button http://bootsnipp.com/snippets/featured/bootstrap-square-buttons -->
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
  <!-- Some scripts added to print the table into the pdf -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.0.272/jspdf.debug.js"></script>

  <button type="button" id="scoreTableBack" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>   Retour</button>
  {{#with getYear}} <!-- Returns a yearData -->
    {{#with getType this}}
      {{>responsablesTemplate this}}
    {{/with}}
  {{/with}}

  <table class="table">
    <tbody>
      <tr>
        <td align="center">
          {{#with getLeader this._id}}
          <h3>Chef de poule: </h3>
          <address>
            <a href="mailto:{{getEmail this}}" class="btn btn-sq-lg btn-primary">
              <i class="fa fa-user fa-5x"></i><br/>
              <strong>{{this.profile.firstName}} {{this.profile.lastName}}</strong><br>
              {{#unless equals this.profile.phone undefined}}<abbr title="Phone">Téléphone:</abbr> {{this.profile.phone}} <br>{{/unless}}
              {{getEmail this}}<br>
            </a>
          </address>
          {{/with}}
        </td>

        <td align="center">
          {{#with getCourt this._id}}
          <h3>Terrain :</h3>
          <div class="btn btn-sq-lg btn-primary">
            <i class="fa fa-home fa-5x"></i><br/>
            <strong> Numéro : {{this.id}} </strong><br>
            {{this.address.street}} {{this.address.number}} <br>
            {{this.address.zipCode}} {{this.address.city}}
          </div>
        {{/with}}
        </td>
      </tr>
    </tbody>
  </table>

  {{>scoreTable this}}

  {{#if isAdminOrStaff}}
    <button type="button" id="getPDF" class="btn btn-default btn-lg" data-pool="{{this._id}}" data-resp="{{this.resp}}">
      <span class="glyphicon glyphicon-download" aria-hidden="true"></span> PDF
    </button>
  {{/if}}
</template>


<!-- Takes 1 parameter : the poolId for this score table under the format {_id:POOLID}-->
<template name="scoreTable">
  <div id="scoreTab">
    <h3>Les paires dans la colonne jouent contre les paires de la ligne.</h3>
    <div class="panel panel-primary" style="background-color:white">
      <div class="panel-heading">Tableaux des résultats</div>
      <table class="table table-bordered" id="scoreTableElement">
        {{#with getPairs this._id}}
        <thead>
          <tr>
            <th>
              <h4><span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span> VS <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span> </h4>
            </th>
            {{#each this}}
            <th>
              {{#with getPlayer this.player1._id}}
              {{this.profile.firstName}} {{this.profile.lastName}} <br>
              {{/with}}
              {{#with getPlayer this.player2._id}}
              {{this.profile.firstName}} {{this.profile.lastName}}
              {{/with}}
            </th>
            {{/each}}
          </tr>
        </thead>

        <tbody>
          {{#each this}}
          <tr>
            <th>
              {{#with getPlayer this.player1._id}}
              {{this.profile.firstName}} {{this.profile.lastName}} <br>
              {{/with}}
              {{#with getPlayer this.player2._id}}
              {{this.profile.firstName}} {{this.profile.lastName}}
              {{/with}}
            </th>

            {{#each ..}}
            {{#if equals this._id ../_id}}
            <td class="selfMatch" style="background-color:grey">  </td>
            {{else}}
            <td align="center">
              <div class="input-group inputscore" display="inline">
                {{#with getMatch ../../../_id ../_id this._id}} <!-- Returns the match corresponding to this pair -->
                  {{#if isAdminOrStaff}}
                    <input
                    type="number"
                    min="0"
                    step="1"
                    class="form-control points"
                    data-matchid="{{this._id}}"
                    data-otherpairid="{{../_id}}"
                    data-pairid="{{../../_id}}"
                    value="{{getPoints this ../../_id}}"
                    style="text-align:center; width=15%">

                    <input
                    type="number"
                    min="0"
                    step="1"
                    class="form-control points"
                    data-matchid="{{this._id}}"
                    data-otherpairid="{{../../_id}}"
                    data-pairid="{{../_id}}"
                    value="{{getPoints this ../_id}}"
                    style="text-align:center; width=15%">
                  {{else}}
                    <span style="align:center; position: relative; top: 50%; transform: translateY(-50%); font-size:200%;">{{getPoints this ../../_id}}</span>
                    -
                    <span style="align:center; position: relative; top: 50%; transform: translateY(-50%); font-size:200%;">{{getPoints this ../_id}}</span>
                  {{/if}}
                {{/with}}
              </div>
            </td>
            {{/if}}
            {{/each}}
          </tr>
          {{/each}}
        </tbody>
        {{/with}}
      </table>
    </div>
  </div>



  <!-- Frame for the pdf viewer -->
  <iframe class="preview-pane" type="application/pdf" height="900" width="100%" frameborder="0" hidden></iframe>
  <br>

</template>

<template name="modalChangeCourt">
  <!-- Modal -->
  <div id="courtToChange" class="modal fade" >
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <div class="modal-title page-header">
            <h3>Changer le terrain</h3>
          </div>
        </div>
        <div class="modal-body">
         {{> courtSearch}} 
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
        </div>
      </div>
    </div>
  </div>
</template>
